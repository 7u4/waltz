<!--
  ~ Waltz - Enterprise Architecture
  ~ Copyright (C) 2016, 2017, 2018, 2019 Waltz open source project
  ~ See README.md for more information
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Lesser General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Lesser General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Lesser General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<div class="row"
     ng-if="! $ctrl.visibility.chart">
    <div class="col-sm-12">
        <waltz-no-data>
            <message>
                <strong>No flow data</strong>
                could be found, therefore unable to show authoritative source summary
            </message>
        </waltz-no-data>
    </div>
</div>

<div class="row"
     ng-show="$ctrl.visibility.chart">
    <div class="col-sm-3">
        <waltz-tree-filter items="$ctrl.dataTypes"
                           on-filter-change="$ctrl.onTreeFilterChange">
        </waltz-tree-filter>
    </div>
    <div class="col-sm-5">

        <!-- INBOUND_SEMI_PIE -->
        <span id="wassp-inbound">
        </span>

        <span ng-include="'wassp-breakdown-table'"></span>

        <!-- OUTBOUND_SEMI_PIE -->
        <span id="wassp-outbound">
        </span>

        <p>Overall percentage of authorised sources =
            <span ng-bind="$ctrl.overallPercentageOfAuthoritiveSources"></span>
            %
        </p>
    </div>
</div>


<script type="text/ng-template" id="wassp-breakdown-table">
    <span style="margin: 1.5em;">
        <table class="small waltz-mini-table"
               style="display: inline-table; vertical-align: top; margin-top: 0.6em">

            <thead>
            <tr>
                <th style="text-align: center;">Inbound</th>
                <th style="text-align: center;">Rating</th>
                <th style="text-align: center;">Outbound</th>
            </tr>
            </thead>

            <tbody>
            <tr ng-repeat="row in $ctrl.rowInfo">
                <td style="text-align: center;">
                    <div ng-style="{ 'opacity' : $ctrl.inboundStats[row.rating] > 0 ? 1 : 0.3 }">
                        <div ng-bind="$ctrl.inboundStats[row.rating]"
                             style="border: 1px solid; padding: 1px; margin: 1px"
                             ng-style="row.style">
                        </div>
                    </div>
                </td>
                <td style="text-align: center;">
                    <waltz-enum-value type="'AuthoritativenessRating'"
                                      show-icon="false"
                                      key="row.rating">
                    </waltz-enum-value>
                </td>
                <td style="text-align: center;">
                    <div ng-style="{ 'opacity' : $ctrl.outboundStats[row.rating] > 0 ? 1 : 0.3 }">
                        <div ng-bind="$ctrl.outboundStats[row.rating]"
                             style="border: 1px solid; padding: 1px; margin: 1px"
                             ng-style="row.style">
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>

        </table>
    </span>
</script>